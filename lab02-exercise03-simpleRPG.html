<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>lab02-exercise03-simpleRPG</title>
    </head>
    <body>
        <script type="text/javascript">
        "use strict"
        // Modified to be guessing game towards hidden goal location
        /* For testing using events to simulate pressing keys,
           please use this format on the console: 
           var event = new KeyboardEvent('keydown', {'key':'ArrowLeft'}); 
           document.dispatchEvent(event);

           #### Note that 'ArrowLeft' can be replaced with any of
           the 3 other directional keys
        */
        class gameGrid {
            constructor(length, height){
                this.length = length;
                this.height = height;
                // keeps track of a hidden goal position
                this.goalrow = Math.floor(Math.random() * height);
                this.goalcolumn = Math.floor(Math.random() * length);
                console.log("New game!");
                //keeps track of obstacle position
                this.obstaclerow = Math.floor(Math.random() * height);
                this.obstaclecol = Math.floor(Math.random() * length);
                
            
            }

            drawGrid(row, column){
                this.grid = ""
                this.checkLocation()
                for (let i = 0; i < this.height; i++) {
                    for (let j = 0; j < this.length; j++){
                        if (row - 1 == i && column - 1 == j){
                            this.grid += "8";
                        } else if(this.obstaclerow === i && this.obstaclecol === j) {
                            this.grid += "O"
                        }else{
                            this.grid += ","
                        }
                    }
                    this.grid += "\n"
                }
                return console.log(this.grid)
            }

            // tells player if they've reached the goal
            isVictory(row, column){
                if (this.goalrow == row && this.goalcolumn == column){
                    console.log("You won! Wait 5 seconds for a new round!");
                    this.refresh();
                    return true
                }
                console.log("Not yet! But...");
                return false
            }

            // tells player how close they are to the hidden goal
            howCloseRow(prevrow, currentrow){
                if (Math.abs(this.goalrow - prevrow) > Math.abs(this.goalrow - currentrow)){
                    console.log("Hotter!");
                } else {
                    console.log("Colder!");
                }
            }

            howCloseColumn(prevcolumn, currentcolumn){
                if (Math.abs(this.goalcolumn - prevcolumn) > Math.abs(this.goalcolumn - currentcolumn)){
                    console.log("Hotter!");
                } else {
                    console.log("Colder!");
                }
            }
            // starts new game after player wins
            refresh(){
                setTimeout(() => {
                    location.reload();
                }, 5000);
            }
            //checks if the location of the obstacle and goal are the same
            //generates a new location if they are
            checkLocation(){
                if (this.obstaclecol === this.goalcolumn || this.obstaclerow === this.goalrow){
                    //create a new random value for the goal.
                    this.obstaclerow = Math.floor(Math.random() * this.height);
                    this.obstaclecol = Math.floor(Math.random() * this.length);
                }
            }
        }

        class player{
            constructor(row, column){
                this.row = row;
                this.column = column;
                this.previousrow = null;
                this.previouscolumn = null;
            }
            
            moveUp(currentGrid) {
                if (this.row > 1 && !(this.row - 1 === currentGrid.obstaclerow && this.column === currentGrid.obstaclecol)) {
                    this.previousrow = this.row;
                    this.row--;
                } else {
                    console.log("Cannot move up! Try again.");
                }
            }
        
            moveDown(currentGrid) {
                if (this.row < currentGrid.height && !(this.row + 1 === currentGrid.obstaclerow && this.column === currentGrid.obstaclecol)) {
                    this.previousrow = this.row;
                    this.row++;
                } else {
                    console.log("Cannot move down! Try again.");
                }
            }
        
            moveLeft(currentGrid) {
                if (this.column > 1 && !(this.row === currentGrid.obstaclerow && this.column - 1 === currentGrid.obstaclecol)) {
                    this.previouscolumn = this.column;
                    this.column--;
                } else {
                    console.log("Cannot move left! Try again.");
                }
            }
        
            moveRight(currentGrid) {
                if (this.column < currentGrid.length && !(this.row === currentGrid.obstaclerow && this.column + 1 === currentGrid.obstaclecol)) {
                    this.previouscolumn = this.column;
                    this.column++;
                } else {
                    console.log("Cannot move right! Try again.");
                }
            }
        }

        const grid1 = new gameGrid(10,10);
        const player1 = new player(10,10);
        grid1.drawGrid(player1.row, player1.column);
    
        // includes checks so player can't go off the grid
        function keyDownFunction(event, currentPlayer, currentGrid){
            if(event.key === "ArrowDown"){
                if(currentPlayer.row !== currentGrid.height){
                    currentPlayer.moveDown(grid1);
                    currentGrid.drawGrid(currentPlayer.row, currentPlayer.column);
                    if (!(currentGrid.isVictory(currentPlayer.row, currentPlayer.column))){
                        currentGrid.howCloseRow(currentPlayer.previousrow, currentPlayer.row);
                    }
                }else{
                    console.log("Out of Bounds! Try Again.");
                }
            }
            if(event.key === "ArrowUp"){
                if(currentPlayer.row !== 1){
                    currentPlayer.moveUp(grid1);
                    currentGrid.drawGrid(currentPlayer.row, currentPlayer.column);
                    if (!(currentGrid.isVictory(currentPlayer.row, currentPlayer.column))){
                        currentGrid.howCloseRow(currentPlayer.previousrow, currentPlayer.row);
                    }
                    }else{
                        console.log("Out of Bounds! Try Again.");
                    }
            }
            if(event.key === "ArrowLeft"){
                if (0 !== currentPlayer.column - 1){
                    currentPlayer.moveLeft(grid1);
                    currentGrid.drawGrid(currentPlayer.row, currentPlayer.column);
                    if (!(currentGrid.isVictory(currentPlayer.row, currentPlayer.column))){
                        currentGrid.howCloseColumn(currentPlayer.previouscolumn, currentPlayer.column);
                    }
                }else{
                    console.log("Out of Bounds! Try Again.");
                }
            }
            if(event.key === "ArrowRight"){
                if (currentGrid.length !== currentPlayer.column){
                    currentPlayer.moveRight(grid1);
                    currentGrid.drawGrid(currentPlayer.row, currentPlayer.column);
                    if (!(currentGrid.isVictory(currentPlayer.row, currentPlayer.column))){
                        currentGrid.howCloseColumn(currentPlayer.previouscolumn, currentPlayer.column);
                    }
                    }else{
                        console.log("Out of Bounds! Try Again.")
                    }
                }
        }

        document.addEventListener('keydown', function (event) {
            keyDownFunction(event, player1, grid1);
        });
        </script>
    </body>
</html>
